# 🧪 السيناريو الكامل للاختبار

## 📋 الخطوات المطلوبة:

### 1️⃣ **إنشاء مدير (Manager)**
- ✅ موجود في seed: `2222220000` / `Test@1234`
- أو إنشاء جديد من `/super-admin` → "إضافة مستخدم"

### 2️⃣ **إنشاء 4 مشرفين (Supervisors)**
- `/super-admin` → "إضافة مستخدم" → اختر "Supervisor"
- كرر 4 مرات

### 3️⃣ **إنشاء 4 معلمين (Teachers) - واحد لكل مادة**
- `/super-admin` → "إضافة مستخدم" → اختر "Teacher"
- معلم لـ: لغة عربية
- معلم لـ: لغة إنجليزية
- معلم لـ: رياضيات
- معلم لـ: علوم

### 4️⃣ **كل معلم يضيف 5 أسئلة**
- سجل دخول كمعلم: `/auth/staff`
- اذهب إلى: `/admin/questions`
- أضف 5 أسئلة (MCQ, Essay, Oral)
- كرر لكل معلم

### 5️⃣ **إنشاء امتحان لصف 5**
- سجل دخول كـ Super Admin: `1111111111` / `Test@1234`
- اذهب إلى: `/super-admin/exams`
- اضغط "إنشاء امتحان جديد"
- املأ البيانات:
  - الاسم: "اختبار الفترة الأولى - الصف الخامس"
  - المدرسة: الأهلية بنين
  - البرنامج: البرنامج العربي
  - الصف: الصف الخامس الابتدائي
  - المادة: رياضيات (مثلاً)
  - التاريخ: اليوم
  - المدة: 60 دقيقة
  - الدرجات: 20
  - درجة النجاح: 12
- اضغط "إنشاء الامتحان"
- اضغط "إدارة الأسئلة"
- أضف 5 أسئلة من قائمة الأسئلة المتاحة

### 6️⃣ **طالب يحل الامتحان**
- سجل دخول كطالب: `5555550000` / PIN: `1001`
- اذهب إلى: `/student/exam`
- اختر الامتحان
- حل الأسئلة:
  - MCQ: اختر إجابة
  - Essay: اكتب نص
  - Oral: سيتم تصحيحه من المعلم
- اضغط "تسليم الامتحان"

### 7️⃣ **كل معلم يصحح المقالي والشفوي**
- سجل دخول كمعلم: `/auth/staff`
- اذهب إلى: `/teacher/grading`
- ستظهر قائمة الامتحانات المعلقة للتصحيح
- لكل سؤال Essay/Oral:
  - أدخل الدرجة
  - أضف ملاحظات (اختياري)
- اضغط "حفظ التصحيح"
- كرر لكل معلم (إذا كان الامتحان يحتوي على أسئلة من مواد متعددة)

### 8️⃣ **4 مشرفين يعتمدون النتيجة**
- سجل دخول كمشرف: `/auth/staff`
- اذهب إلى: `/supervisor/approvals`
- ستظهر قائمة الدرجات المعلقة للاعتماد
- راجع الدرجات والإجابات
- إما:
  - اعتمد الدرجة (Approve)
  - عدّل الدرجة (إذا كان هناك خطأ)
- كرر لكل مشرف

### 9️⃣ **المدير يعتمد النتيجة النهائية**
- سجل دخول كمدير: `/auth/staff`
- اذهب إلى: `/manager/grade-approvals`
- ستظهر قائمة الدرجات المعلقة للاعتماد النهائي
- راجع الدرجات الكلية
- اختر الحالة النهائية:
  - ✅ قبول (Approved)
  - ❌ رفض (Rejected)
  - ⚠️ قبول مشروط (Conditional)
- أضف ملاحظات (اختياري)
- اضغط "اعتماد النتيجة النهائية"

---

## 🔍 الـ APIs المستخدمة:

### **إدارة الامتحانات:**
- `POST /api/super-admin/exams` - إنشاء امتحان
- `GET /api/super-admin/exams` - قائمة الامتحانات
- `POST /api/super-admin/exams/questions` - إضافة أسئلة للامتحان
- `DELETE /api/super-admin/exams/questions` - حذف سؤال من الامتحان

### **إضافة أسئلة (المعلم):**
- `POST /api/teacher/questions/create` - إضافة سؤال جديد

### **الطالب:**
- `GET /api/student/exams` - الامتحانات المتاحة
- `POST /api/attempts/start` - بدء الامتحان
- `POST /api/attempts/answer` - حفظ إجابة
- `POST /api/attempts/submit` - تسليم الامتحان

### **المعلم:**
- `GET /api/teacher/pending` - الامتحانات المعلقة للتصحيح
- `POST /api/teacher/grade` - تصحيح السؤال

### **المشرف:**
- `GET /api/supervisor/approvals` - الدرجات المعلقة للاعتماد
- `POST /api/supervisor/approvals` - اعتماد الدرجات

### **المدير:**
- `GET /api/manager/grade-approvals` - الدرجات المعلقة للاعتماد النهائي
- `POST /api/manager/grade-approvals` - اعتماد النتيجة النهائية

---

## ⚠️ ملاحظات مهمة:

### 1. **ربط المعلمين بالمواد:**
- يجب إنشاء **Teacher Assignment** من `/super-admin/assignments`
- ربط المعلم بـ: المادة + المدرسة + البرنامج + الصفوف

### 2. **ربط المشرفين:**
- يجب إنشاء **Supervisor Assignment** من `/super-admin/assignments`
- ربط المشرف بالمعلمين اللي هيشرف عليهم

### 3. **ربط المديرين:**
- يجب إنشاء **Manager Assignment** من `/super-admin/assignments`
- ربط المدير بـ: المدرسة + البرنامج + الصفوف

### 4. **التسلسل الصحيح:**
```
طالب يحل 
  ↓
MCQ تُصحح تلقائياً
  ↓
معلم يصحح Essay/Oral
  ↓
مشرف يعتمد تصحيح المعلم
  ↓
مدير يعتمد النتيجة النهائية
```

---

## 🚨 المشاكل المحتملة وحلولها:

### ❌ **مشكلة: المعلم لا يرى امتحانات للتصحيح**
**السبب**: لا يوجد Teacher Assignment
**الحل**: 
1. اذهب إلى `/super-admin/assignments`
2. تبويب "Teacher Assignments"
3. اختر المعلم + المادة + المدرسة + البرنامج + الصفوف
4. اضغط "إنشاء ربط"

### ❌ **مشكلة: المشرف لا يرى درجات للاعتماد**
**السبب**: لا يوجد Supervisor Assignment
**الحل**:
1. اذهب إلى `/super-admin/assignments`
2. تبويب "Supervisor Assignments"
3. اختر المشرف + المعلمين
4. اضغط "إنشاء ربط"

### ❌ **مشكلة: المدير لا يرى درجات للاعتماد النهائي**
**السبب**: لا يوجد Manager Assignment
**الحل**:
1. اذهب إلى `/super-admin/assignments`
2. تبويب "Manager Assignments"
3. اختر المدير + المدرسة + البرنامج + الصفوف
4. اضغط "إنشاء ربط"

### ❌ **مشكلة: الطالب لا يرى الامتحان**
**الأسباب المحتملة**:
1. الامتحان لم يبدأ بعد (تحقق من `startDate`)
2. الامتحان انتهى (تحقق من `endDate`)
3. الامتحان لمدرسة/برنامج/صف مختلف عن بيانات الطالب
4. الامتحان غير نشط (`isActive = false`)

### ❌ **مشكلة: رفع الصور لا يعمل بشكل دائم**
**السبب**: الصور تُحفظ في `/tmp` (مؤقتة)
**الحل المؤقت**: استخدم روابط صور خارجية (URL)
**الحل الدائم**: تكامل مع Vercel Blob أو AWS S3

---

## 📊 التحقق من النجاح:

بعد إتمام السيناريو بالكامل، تحقق من:

1. ✅ الطالب يرى النتيجة النهائية في `/student/results`
2. ✅ المدير يرى الحالة النهائية "Approved" في Dashboard
3. ✅ التقارير تعرض البيانات بشكل صحيح
4. ✅ جميع الدرجات محفوظة في قاعدة البيانات

---

## 🎯 الملخص:

### ✅ ما تم إنجازه:
1. ✅ Exam Model محدث بكل الحقول المطلوبة
2. ✅ APIs كاملة لإدارة الامتحانات
3. ✅ واجهة UI كاملة لإنشاء وإدارة الامتحانات
4. ✅ نظام التصحيح التلقائي للـ MCQ
5. ✅ نظام تصحيح المعلم للـ Essay/Oral
6. ✅ نظام اعتماد المشرف
7. ✅ نظام الاعتماد النهائي من المدير
8. ✅ Build و Deploy ناجح

### 🔄 الخطوات التالية للمستخدم:
1. انتظر انتهاء Deploy على Vercel (3-5 دقائق)
2. سجل دخول Super Admin
3. اذهب إلى `/setup` واضغط "ملء قاعدة البيانات الكاملة"
4. ابدأ تنفيذ السيناريو خطوة بخطوة
5. أبلغني بأي مشاكل تواجهها

---

## 📞 الدعم:

إذا واجهت أي مشكلة:
1. تحقق من console في المتصفح (F12)
2. تحقق من Vercel Logs
3. راجع الـ APIs المذكورة أعلاه
4. تأكد من صحة الـ Assignments


